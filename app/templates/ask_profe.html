{% extends "base.html" %}

{% block title %}Pregúntale al profe{% endblock %}

{% block content %}
  <section class="ask-profe">
    <h2>Pregúntale al profe</h2>
    <p>Escribe tu duda, elige un modelo y el profe te responderá.</p>

    <form method="post" class="ask-form" id="ask-form">
      <div>
        <label for="model">Modelo</label>
        <select id="model" name="model">
          {% for model in models %}
            <option value="{{ model }}" {% if model == selected_model %}selected{% endif %}>
              {{ model }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div>
        <label for="question">Tu pregunta</label>
        <textarea id="question" name="question" rows="4" required></textarea>
      </div>

      <button type="submit" id="submit-btn">Enviar</button>
    </form>

    <!-- Indicador de carga -->
    <div id="loading-indicator" style="display: none; margin-top: 1rem;">
      <em>El profe está pensando... ⏳</em>
    </div>

    {% if messages %}
      <div class="chat" style="margin-top: 2rem;">
        {% for msg in messages %}
          <div class="chat-message {{ msg.role }}" style="margin-bottom: 0.75rem;">
            <strong>
              {% if msg.role == 'user' %}Tú{% else %}Profe{% endif %}:
            </strong>
            <p>{{ msg.content }}</p>
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </section>

  <script>
    // JS sencillo para mostrar el "loading" cuando se envía el formulario
    const form = document.getElementById("ask-form");
    const loading = document.getElementById("loading-indicator");
    const submitBtn = document.getElementById("submit-btn");

    if (form && loading && submitBtn) {
      form.addEventListener("submit", function () {
        // mostrar indicador
        loading.style.display = "block";
        // desactivar botón para evitar envíos dobles
        submitBtn.disabled = true;
        submitBtn.textContent = "Enviando...";
      });
    }
  </script>
{% endblock %}
